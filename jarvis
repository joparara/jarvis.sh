#!/bin/bash

TODO_FILE="$HOME/.todolist"
myname="joparara"

# === MODULES ===

add_todo() {
    echo "- [ ] $1" >> "$TODO_FILE"
    echo "Added: $1"
}

delete_todo() {
    if [[ -z "$1" ]]; then
        echo "Error: No line number given"
        return 1
    fi
    sed -i "${1}d" "$TODO_FILE"
    echo "Deleted item $1"
}

show_todo() {
    if [[ ! -f "$TODO_FILE" || ! -s "$TODO_FILE" ]]; then
        echo "Your todo list is empty."
        return
    fi
    # Only show undone items, remove leading '- [ ]', and number them
    grep '^- \[ \]' "$TODO_FILE" | sed 's/^- \[ \] //' | awk '{print NR".", $0}'
   

    # WAS nl -w2 -s'. ' "$TODO_FILE"
}

greet_user() {
    mytime=$(date +"%H:%M %Z")
    echo -e "$mytime >>>\nHello ${myname^}!"
}

usage() {
    echo "Usage:"
    echo "  $0 -a \"task\"     Add task"
    echo "  $0 -d 2           Delete task"
    echo "  $0 -s             Show list"
}

# === ROUTER ===

case "$1" in
  -a)
    shift
    add_todo "$*"
    ;;
  -d)
    shift
    delete_todo "$1"
    ;;
  -s)
    show_todo
    ;;
  "")
    greet_user
    ;;
  *)
    usage
    ;;
esac
